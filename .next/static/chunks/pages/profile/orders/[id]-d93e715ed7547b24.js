(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[187],{5649:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/profile/orders/[id]",function(){return t(9969)}])},5822:function(e,s,t){"use strict";var a=t(5893);t(7294);var l=t(1664),i=t.n(l),r=t(3299);s.Z=e=>{let{children:s}=e,{data:t}=(0,r.useSession)();return(0,a.jsxs)("div",{className:"min-h-screen flex flex-col",children:[(0,a.jsx)("header",{className:"bg-white shadow",children:(0,a.jsx)("nav",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex justify-between h-16",children:[(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)(i(),{href:"/",className:"flex items-center",children:(0,a.jsx)("span",{className:"text-xl font-bold text-primary",children:"AparelEC"})}),(0,a.jsxs)("div",{className:"hidden sm:ml-6 sm:flex sm:space-x-8",children:[(0,a.jsx)(i(),{href:"/customize",className:"inline-flex items-center px-1 pt-1 text-gray-900 hover:text-primary",children:"カスタマイズ"}),(0,a.jsx)(i(),{href:"/products",className:"inline-flex items-center px-1 pt-1 text-gray-900 hover:text-primary",children:"商品一覧"})]})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)(i(),{href:"/cart",className:"p-2 text-gray-900 hover:text-primary",children:"\uD83D\uDED2 カート"}),t?(0,a.jsxs)("div",{className:"ml-4 flex items-center space-x-4",children:[(0,a.jsx)(i(),{href:"/profile",className:"text-gray-900 hover:text-primary",children:"マイページ"}),(0,a.jsx)("button",{onClick:()=>(0,r.signOut)(),className:"text-gray-900 hover:text-primary",children:"ログアウト"})]}):(0,a.jsxs)("div",{className:"ml-4 flex items-center space-x-4",children:[(0,a.jsx)(i(),{href:"/auth/login",className:"text-gray-900 hover:text-primary",children:"ログイン"}),(0,a.jsx)(i(),{href:"/auth/register",className:"bg-primary text-white px-4 py-2 rounded hover:bg-primary/90",children:"新規登録"})]})]})]})})}),(0,a.jsx)("main",{className:"flex-grow",children:s}),(0,a.jsx)("footer",{className:"bg-gray-800 text-white",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"AparelEC"}),(0,a.jsxs)("p",{className:"text-gray-400",children:["高品質なスポーツユニフォームを",(0,a.jsx)("br",{}),"お手頃価格で提供します"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"リンク"}),(0,a.jsxs)("ul",{className:"space-y-2",children:[(0,a.jsx)("li",{children:(0,a.jsx)(i(),{href:"/about",className:"text-gray-400 hover:text-white",children:"会社概要"})}),(0,a.jsx)("li",{children:(0,a.jsx)(i(),{href:"/contact",className:"text-gray-400 hover:text-white",children:"お問い合わせ"})}),(0,a.jsx)("li",{children:(0,a.jsx)(i(),{href:"/privacy",className:"text-gray-400 hover:text-white",children:"プライバシーポリシー"})})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"お問い合わせ"}),(0,a.jsxs)("p",{className:"text-gray-400",children:["メール: info@aparelec.com",(0,a.jsx)("br",{}),"電話: 03-1234-5678"]})]})]}),(0,a.jsx)("div",{className:"mt-8 pt-8 border-t border-gray-700 text-center text-gray-400",children:(0,a.jsx)("p",{children:"\xa9 2024 AparelEC. All rights reserved."})})]})})]})}},9969:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return j}});var a=t(5893),l=t(7294),i=t(3299),r=t(1163),c=t(5822),n=e=>{let{isOpen:s,onClose:t,onConfirm:i,isCancelling:r}=e,[c,n]=(0,l.useState)("");return s?(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"注文のキャンセル"}),(0,a.jsx)("p",{className:"text-gray-600 mb-4",children:"キャンセル理由を入力してください。"}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),i(c)},children:[(0,a.jsx)("textarea",{value:c,onChange:e=>n(e.target.value),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4",rows:4,placeholder:"キャンセル理由を入力してください",required:!0}),(0,a.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,a.jsx)("button",{type:"button",onClick:t,className:"btn-secondary",disabled:r,children:"キャンセル"}),(0,a.jsx)("button",{type:"submit",className:"btn-danger",disabled:r||!c.trim(),children:r?"キャンセル中...":"注文をキャンセル"})]})]})]})}):null},d=t(385),x=t(5753),m=e=>{let{trackingNumber:s,history:t}=e;return(0,a.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"配送状況"}),(0,a.jsxs)("p",{className:"mb-2",children:["追跡番号: ",s]}),(0,a.jsx)("div",{className:"space-y-2",children:t.map((e,s)=>(0,a.jsxs)("div",{className:"border-l-2 border-gray-200 pl-4",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:e.timestamp}),(0,a.jsx)("p",{className:"font-medium",children:e.status}),(0,a.jsx)("p",{className:"text-sm",children:e.location})]},s))}),(0,a.jsx)("button",{onClick:()=>{let e=(0,x.V)(t);(0,x.n)(e,"tracking-".concat(s,".csv"))},className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"CSVエクスポート"})]})},o=e=>{let{orderId:s,trackingInfo:t}=e,[i,r]=(0,l.useState)(!1),[c,n]=(0,l.useState)(!1),[d,x]=(0,l.useState)("");(0,l.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/orders/".concat(s,"/notifications")),t=await e.json();r(t.isSubscribed)}catch(e){console.error("通知設定の取得に失敗しました:",e)}})()},[s]);let m=async()=>{n(!0),x("");try{if(!(await fetch("/api/orders/".concat(s,"/notifications"),{method:i?"DELETE":"POST"})).ok)throw Error("通知設定の更新に失敗しました");r(!i)}catch(e){x("通知設定の更新に失敗しました"),console.error("通知設定の更新エラー:",e)}finally{n(!1)}};return(0,a.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-4",children:"配送状況の通知設定"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"配送状況の更新をメールで通知"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"配送状況が更新された際に、メールで通知を受け取ります"})]}),(0,a.jsx)("button",{onClick:m,disabled:c,className:"px-4 py-2 rounded-md text-sm font-medium ".concat(i?"bg-red-100 text-red-700 hover:bg-red-200":"bg-blue-100 text-blue-700 hover:bg-blue-200"),children:c?"処理中...":i?"通知を解除":"通知を設定"})]}),d&&(0,a.jsx)("p",{className:"text-sm text-red-600 mt-2",children:d}),i&&(0,a.jsxs)("div",{className:"bg-blue-50 p-4 rounded-md",children:[(0,a.jsx)("p",{className:"text-sm text-blue-700",children:"現在、配送状況の更新をメールで通知する設定が有効になっています。"}),t.estimatedDelivery&&(0,a.jsxs)("p",{className:"text-sm text-blue-700 mt-1",children:["予定配達日: ",new Date(t.estimatedDelivery).toLocaleDateString("ja-JP")]})]})]})]})};let h=new d.PrismaClient;var j=()=>{let{data:e}=(0,i.useSession)(),s=(0,r.useRouter)(),{id:t}=s.query,[d,x]=(0,l.useState)(null),[j,p]=(0,l.useState)(""),[u,N]=(0,l.useState)(!0),[b,g]=(0,l.useState)(!1),[f,y]=(0,l.useState)(!1);(0,l.useEffect)(()=>{(async()=>{var s;if((null==e?void 0:null===(s=e.user)||void 0===s?void 0:s.id)&&t)try{let s=await h.order.findFirst({where:{id:t,userId:e.user.id},include:{items:!0,shippingAddress:!0}});s?x(s):p("注文が見つかりません")}catch(e){console.error("注文データの取得エラー:",e),p("注文データの取得に失敗しました")}finally{N(!1)}})()},[e,t]);let v=async e=>{if(d){g(!0);try{let s=await fetch("/api/orders/".concat(d.id,"/cancel"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:e})});if(!s.ok)throw Error("キャンセルに失敗しました");let t=await s.json();x(t),y(!1)}catch(e){console.error("キャンセルエラー:",e),p("注文のキャンセルに失敗しました")}finally{g(!1)}}};return e?u?(0,a.jsx)(c.Z,{children:(0,a.jsx)("div",{className:"max-w-4xl mx-auto py-12 text-center",children:(0,a.jsx)("p",{className:"text-gray-600",children:"読み込み中..."})})}):j||!d?(0,a.jsx)(c.Z,{children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto py-12",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"注文詳細"}),(0,a.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:j||"注文が見つかりません"})]})}):(0,a.jsx)(c.Z,{children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto py-12",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"注文詳細"}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"bg-white shadow rounded-lg p-6",children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"注文情報"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"注文番号"}),(0,a.jsx)("p",{className:"font-medium",children:d.id})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"注文日時"}),(0,a.jsx)("p",{className:"font-medium",children:new Date(d.createdAt).toLocaleString("ja-JP")})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"注文状態"}),(0,a.jsx)("p",{className:"font-medium",children:d.status})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"合計金額"}),(0,a.jsxs)("p",{className:"font-medium",children:["\xa5",d.totalAmount.toLocaleString()]})]})]})]}),"cancelled"===d.status&&d.cancelReason&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"キャンセル情報"}),(0,a.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,a.jsxs)("div",{className:"mb-2",children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"キャンセル日時"}),(0,a.jsx)("p",{className:"font-medium",children:d.cancelledAt&&new Date(d.cancelledAt).toLocaleString("ja-JP")})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"キャンセル理由"}),(0,a.jsx)("p",{className:"whitespace-pre-wrap",children:d.cancelReason})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"商品一覧"}),(0,a.jsx)("div",{className:"space-y-4",children:d.items.map(e=>(0,a.jsx)("div",{className:"border rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium",children:e.productName}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["数量: ",e.quantity,"個"]}),(0,a.jsxs)("p",{className:"text-sm text-gray-600",children:["単価: \xa5",e.price.toLocaleString()]}),(0,a.jsxs)("div",{className:"mt-2 text-sm",children:[(0,a.jsx)("p",{children:"カスタマイズ情報:"}),(0,a.jsxs)("ul",{className:"list-disc list-inside text-gray-600",children:[(0,a.jsxs)("li",{children:["カラー: ",e.customization.color]}),(0,a.jsxs)("li",{children:["サイズ: ",e.customization.size]}),(0,a.jsxs)("li",{children:["背番号: ",e.customization.number]})]})]})]}),(0,a.jsxs)("p",{className:"font-medium",children:["\xa5",(e.price*e.quantity).toLocaleString()]})]})},e.id))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"配送先情報"}),(0,a.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,a.jsx)("p",{className:"font-medium",children:d.shippingAddress.name}),(0,a.jsxs)("p",{className:"text-gray-600",children:["〒",d.shippingAddress.zipCode,(0,a.jsx)("br",{}),d.shippingAddress.prefecture,d.shippingAddress.city,d.shippingAddress.street,d.shippingAddress.building&&(0,a.jsx)("br",{}),d.shippingAddress.building]}),(0,a.jsxs)("p",{className:"text-gray-600 mt-1",children:["TEL: ",d.shippingAddress.phone]})]})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("button",{onClick:()=>s.push("/profile?tab=orders"),className:"btn-secondary",children:"注文履歴に戻る"}),"pending"===d.status&&(0,a.jsx)("button",{onClick:()=>y(!0),className:"btn-danger",children:"注文をキャンセル"})]})]})}),"shipped"===d.status&&d.trackingInfo&&(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)(m,{orderId:d.id,...d.trackingInfo}),(0,a.jsx)(o,{orderId:d.id,trackingInfo:d.trackingInfo})]})]}),(0,a.jsx)(n,{isOpen:f,onClose:()=>y(!1),onConfirm:v,isCancelling:b})]})}):(0,a.jsx)(c.Z,{children:(0,a.jsxs)("div",{className:"max-w-4xl mx-auto py-12 text-center",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-4",children:"ログインが必要です"}),(0,a.jsx)("p",{className:"text-gray-600 mb-8",children:"注文履歴を表示するにはログインしてください。"})]})})}},5753:function(e,s,t){"use strict";t.d(s,{V:function(){return a},n:function(){return l}});let a=e=>["タイムスタンプ,ステータス,場所",...e.map(e=>[e.timestamp,e.status,e.location]).map(e=>e.join(","))].join("\n"),l=(e,s)=>{let t=new Blob([e],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),l=URL.createObjectURL(t);a.setAttribute("href",l),a.setAttribute("download",s),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)}}},function(e){e.O(0,[664,299,257,888,774,179],function(){return e(e.s=5649)}),_N_E=e.O()}]);