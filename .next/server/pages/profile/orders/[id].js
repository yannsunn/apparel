(()=>{var e={};e.id=187,e.ids=[187,888,660],e.modules={5113:(e,s,t)=>{"use strict";t.r(s),t.d(s,{config:()=>P,default:()=>y,getServerSideProps:()=>S,getStaticPaths:()=>w,getStaticProps:()=>v,reportWebVitals:()=>A,routeModule:()=>L,unstable_getServerProps:()=>E,unstable_getServerSideProps:()=>D,unstable_getStaticParams:()=>q,unstable_getStaticPaths:()=>C,unstable_getStaticProps:()=>k});var r={};t.r(r),t.d(r,{default:()=>N});var a=t(7093),i=t(5244),l=t(1323),c=t(8942),n=t(5780),d=t(997),x=t(6689),m=t(1649),o=t(1163),h=t(5734);let p=({isOpen:e,onClose:s,onConfirm:t,isCancelling:r})=>{let[a,i]=(0,x.useState)("");return e?d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,d.jsxs)("div",{className:"bg-white rounded-lg p-6 max-w-md w-full mx-4",children:[d.jsx("h2",{className:"text-xl font-semibold mb-4",children:"注文のキャンセル"}),d.jsx("p",{className:"text-gray-600 mb-4",children:"キャンセル理由を入力してください。"}),(0,d.jsxs)("form",{onSubmit:e=>{e.preventDefault(),t(a)},children:[d.jsx("textarea",{value:a,onChange:e=>i(e.target.value),className:"w-full px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4",rows:4,placeholder:"キャンセル理由を入力してください",required:!0}),(0,d.jsxs)("div",{className:"flex justify-end gap-4",children:[d.jsx("button",{type:"button",onClick:s,className:"btn-secondary",disabled:r,children:"キャンセル"}),d.jsx("button",{type:"submit",className:"btn-danger",disabled:r||!a.trim(),children:r?"キャンセル中...":"注文をキャンセル"})]})]})]})}):null};var u=t(3524),j=t(641);let g=({trackingNumber:e,history:s})=>(0,d.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[d.jsx("h3",{className:"text-lg font-semibold mb-4",children:"配送状況"}),(0,d.jsxs)("p",{className:"mb-2",children:["追跡番号: ",e]}),d.jsx("div",{className:"space-y-2",children:s.map((e,s)=>(0,d.jsxs)("div",{className:"border-l-2 border-gray-200 pl-4",children:[d.jsx("p",{className:"text-sm text-gray-500",children:e.timestamp}),d.jsx("p",{className:"font-medium",children:e.status}),d.jsx("p",{className:"text-sm",children:e.location})]},s))}),d.jsx("button",{onClick:()=>{let t=(0,j.V)(s);(0,j.n)(t,`tracking-${e}.csv`)},className:"mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"CSVエクスポート"})]}),b=({orderId:e,trackingInfo:s})=>{let[t,r]=(0,x.useState)(!1),[a,i]=(0,x.useState)(!1),[l,c]=(0,x.useState)("");(0,x.useEffect)(()=>{(async()=>{try{let s=await fetch(`/api/orders/${e}/notifications`),t=await s.json();r(t.isSubscribed)}catch(e){console.error("通知設定の取得に失敗しました:",e)}})()},[e]);let n=async()=>{i(!0),c("");try{if(!(await fetch(`/api/orders/${e}/notifications`,{method:t?"DELETE":"POST"})).ok)throw Error("通知設定の更新に失敗しました");r(!t)}catch(e){c("通知設定の更新に失敗しました"),console.error("通知設定の更新エラー:",e)}finally{i(!1)}};return(0,d.jsxs)("div",{className:"bg-white shadow rounded-lg p-6",children:[d.jsx("h3",{className:"text-lg font-semibold mb-4",children:"配送状況の通知設定"}),(0,d.jsxs)("div",{className:"space-y-4",children:[(0,d.jsxs)("div",{className:"flex items-center justify-between",children:[(0,d.jsxs)("div",{children:[d.jsx("p",{className:"text-sm text-gray-600",children:"配送状況の更新をメールで通知"}),d.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"配送状況が更新された際に、メールで通知を受け取ります"})]}),d.jsx("button",{onClick:n,disabled:a,className:`px-4 py-2 rounded-md text-sm font-medium ${t?"bg-red-100 text-red-700 hover:bg-red-200":"bg-blue-100 text-blue-700 hover:bg-blue-200"}`,children:a?"処理中...":t?"通知を解除":"通知を設定"})]}),l&&d.jsx("p",{className:"text-sm text-red-600 mt-2",children:l}),t&&(0,d.jsxs)("div",{className:"bg-blue-50 p-4 rounded-md",children:[d.jsx("p",{className:"text-sm text-blue-700",children:"現在、配送状況の更新をメールで通知する設定が有効になっています。"}),s.estimatedDelivery&&(0,d.jsxs)("p",{className:"text-sm text-blue-700 mt-1",children:["予定配達日: ",new Date(s.estimatedDelivery).toLocaleDateString("ja-JP")]})]})]})]})},f=new u.PrismaClient,N=()=>{let{data:e}=(0,m.useSession)(),s=(0,o.useRouter)(),{id:t}=s.query,[r,a]=(0,x.useState)(null),[i,l]=(0,x.useState)(""),[c,n]=(0,x.useState)(!0),[u,j]=(0,x.useState)(!1),[N,y]=(0,x.useState)(!1);(0,x.useEffect)(()=>{(async()=>{if(e?.user?.id&&t)try{let s=await f.order.findFirst({where:{id:t,userId:e.user.id},include:{items:!0,shippingAddress:!0}});s?a(s):l("注文が見つかりません")}catch(e){console.error("注文データの取得エラー:",e),l("注文データの取得に失敗しました")}finally{n(!1)}})()},[e,t]);let v=async e=>{if(r){j(!0);try{let s=await fetch(`/api/orders/${r.id}/cancel`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:e})});if(!s.ok)throw Error("キャンセルに失敗しました");let t=await s.json();a(t),y(!1)}catch(e){console.error("キャンセルエラー:",e),l("注文のキャンセルに失敗しました")}finally{j(!1)}}};return e?c?d.jsx(h.Z,{children:d.jsx("div",{className:"max-w-4xl mx-auto py-12 text-center",children:d.jsx("p",{className:"text-gray-600",children:"読み込み中..."})})}):i||!r?d.jsx(h.Z,{children:(0,d.jsxs)("div",{className:"max-w-4xl mx-auto py-12",children:[d.jsx("h1",{className:"text-3xl font-bold mb-8",children:"注文詳細"}),d.jsx("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:i||"注文が見つかりません"})]})}):d.jsx(h.Z,{children:(0,d.jsxs)("div",{className:"max-w-4xl mx-auto py-12",children:[d.jsx("h1",{className:"text-3xl font-bold mb-8",children:"注文詳細"}),(0,d.jsxs)("div",{className:"space-y-6",children:[d.jsx("div",{className:"bg-white shadow rounded-lg p-6",children:(0,d.jsxs)("div",{className:"space-y-6",children:[(0,d.jsxs)("div",{children:[d.jsx("h2",{className:"text-xl font-semibold mb-4",children:"注文情報"}),(0,d.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,d.jsxs)("div",{children:[d.jsx("p",{className:"text-sm text-gray-600",children:"注文番号"}),d.jsx("p",{className:"font-medium",children:r.id})]}),(0,d.jsxs)("div",{children:[d.jsx("p",{className:"text-sm text-gray-600",children:"注文日時"}),d.jsx("p",{className:"font-medium",children:new Date(r.createdAt).toLocaleString("ja-JP")})]}),(0,d.jsxs)("div",{children:[d.jsx("p",{className:"text-sm text-gray-600",children:"注文状態"}),d.jsx("p",{className:"font-medium",children:r.status})]}),(0,d.jsxs)("div",{children:[d.jsx("p",{className:"text-sm text-gray-600",children:"合計金額"}),(0,d.jsxs)("p",{className:"font-medium",children:["\xa5",r.totalAmount.toLocaleString()]})]})]})]}),"cancelled"===r.status&&r.cancelReason&&(0,d.jsxs)("div",{children:[d.jsx("h2",{className:"text-xl font-semibold mb-4",children:"キャンセル情報"}),(0,d.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:[(0,d.jsxs)("div",{className:"mb-2",children:[d.jsx("p",{className:"text-sm text-gray-600",children:"キャンセル日時"}),d.jsx("p",{className:"font-medium",children:r.cancelledAt&&new Date(r.cancelledAt).toLocaleString("ja-JP")})]}),(0,d.jsxs)("div",{children:[d.jsx("p",{className:"text-sm text-gray-600",children:"キャンセル理由"}),d.jsx("p",{className:"whitespace-pre-wrap",children:r.cancelReason})]})]})]}),(0,d.jsxs)("div",{children:[d.jsx("h2",{className:"text-xl font-semibold mb-4",children:"商品一覧"}),d.jsx("div",{className:"space-y-4",children:r.items.map(e=>d.jsx("div",{className:"border rounded-lg p-4",children:(0,d.jsxs)("div",{className:"flex justify-between items-start",children:[(0,d.jsxs)("div",{children:[d.jsx("h3",{className:"font-medium",children:e.productName}),(0,d.jsxs)("p",{className:"text-sm text-gray-600",children:["数量: ",e.quantity,"個"]}),(0,d.jsxs)("p",{className:"text-sm text-gray-600",children:["単価: \xa5",e.price.toLocaleString()]}),(0,d.jsxs)("div",{className:"mt-2 text-sm",children:[d.jsx("p",{children:"カスタマイズ情報:"}),(0,d.jsxs)("ul",{className:"list-disc list-inside text-gray-600",children:[(0,d.jsxs)("li",{children:["カラー: ",e.customization.color]}),(0,d.jsxs)("li",{children:["サイズ: ",e.customization.size]}),(0,d.jsxs)("li",{children:["背番号: ",e.customization.number]})]})]})]}),(0,d.jsxs)("p",{className:"font-medium",children:["\xa5",(e.price*e.quantity).toLocaleString()]})]})},e.id))})]}),(0,d.jsxs)("div",{children:[d.jsx("h2",{className:"text-xl font-semibold mb-4",children:"配送先情報"}),(0,d.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[d.jsx("p",{className:"font-medium",children:r.shippingAddress.name}),(0,d.jsxs)("p",{className:"text-gray-600",children:["〒",r.shippingAddress.zipCode,d.jsx("br",{}),r.shippingAddress.prefecture,r.shippingAddress.city,r.shippingAddress.street,r.shippingAddress.building&&d.jsx("br",{}),r.shippingAddress.building]}),(0,d.jsxs)("p",{className:"text-gray-600 mt-1",children:["TEL: ",r.shippingAddress.phone]})]})]}),(0,d.jsxs)("div",{className:"flex justify-between items-center",children:[d.jsx("button",{onClick:()=>s.push("/profile?tab=orders"),className:"btn-secondary",children:"注文履歴に戻る"}),"pending"===r.status&&d.jsx("button",{onClick:()=>y(!0),className:"btn-danger",children:"注文をキャンセル"})]})]})}),"shipped"===r.status&&r.trackingInfo&&(0,d.jsxs)("div",{className:"space-y-6",children:[d.jsx(g,{orderId:r.id,...r.trackingInfo}),d.jsx(b,{orderId:r.id,trackingInfo:r.trackingInfo})]})]}),d.jsx(p,{isOpen:N,onClose:()=>y(!1),onConfirm:v,isCancelling:u})]})}):d.jsx(h.Z,{children:(0,d.jsxs)("div",{className:"max-w-4xl mx-auto py-12 text-center",children:[d.jsx("h1",{className:"text-3xl font-bold mb-4",children:"ログインが必要です"}),d.jsx("p",{className:"text-gray-600 mb-8",children:"注文履歴を表示するにはログインしてください。"})]})})},y=(0,l.l)(r,"default"),v=(0,l.l)(r,"getStaticProps"),w=(0,l.l)(r,"getStaticPaths"),S=(0,l.l)(r,"getServerSideProps"),P=(0,l.l)(r,"config"),A=(0,l.l)(r,"reportWebVitals"),k=(0,l.l)(r,"unstable_getStaticProps"),C=(0,l.l)(r,"unstable_getStaticPaths"),q=(0,l.l)(r,"unstable_getStaticParams"),E=(0,l.l)(r,"unstable_getServerProps"),D=(0,l.l)(r,"unstable_getServerSideProps"),L=new a.PagesRouteModule({definition:{kind:i.x.PAGES,page:"/profile/orders/[id]",pathname:"/profile/orders/[id]",bundlePath:"",filename:""},components:{App:n.default,Document:c.default},userland:r})},5734:(e,s,t)=>{"use strict";t.d(s,{Z:()=>c});var r=t(997);t(6689);var a=t(1664),i=t.n(a),l=t(1649);let c=({children:e})=>{let{data:s}=(0,l.useSession)();return(0,r.jsxs)("div",{className:"min-h-screen flex flex-col",children:[r.jsx("header",{className:"bg-white shadow",children:r.jsx("nav",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex justify-between h-16",children:[(0,r.jsxs)("div",{className:"flex",children:[r.jsx(i(),{href:"/",className:"flex items-center",children:r.jsx("span",{className:"text-xl font-bold text-primary",children:"AparelEC"})}),(0,r.jsxs)("div",{className:"hidden sm:ml-6 sm:flex sm:space-x-8",children:[r.jsx(i(),{href:"/customize",className:"inline-flex items-center px-1 pt-1 text-gray-900 hover:text-primary",children:"カスタマイズ"}),r.jsx(i(),{href:"/products",className:"inline-flex items-center px-1 pt-1 text-gray-900 hover:text-primary",children:"商品一覧"})]})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx(i(),{href:"/cart",className:"p-2 text-gray-900 hover:text-primary",children:"\uD83D\uDED2 カート"}),s?(0,r.jsxs)("div",{className:"ml-4 flex items-center space-x-4",children:[r.jsx(i(),{href:"/profile",className:"text-gray-900 hover:text-primary",children:"マイページ"}),r.jsx("button",{onClick:()=>(0,l.signOut)(),className:"text-gray-900 hover:text-primary",children:"ログアウト"})]}):(0,r.jsxs)("div",{className:"ml-4 flex items-center space-x-4",children:[r.jsx(i(),{href:"/auth/login",className:"text-gray-900 hover:text-primary",children:"ログイン"}),r.jsx(i(),{href:"/auth/register",className:"bg-primary text-white px-4 py-2 rounded hover:bg-primary/90",children:"新規登録"})]})]})]})})}),r.jsx("main",{className:"flex-grow",children:e}),r.jsx("footer",{className:"bg-gray-800 text-white",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",children:"AparelEC"}),(0,r.jsxs)("p",{className:"text-gray-400",children:["高品質なスポーツユニフォームを",r.jsx("br",{}),"お手頃価格で提供します"]})]}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",children:"リンク"}),(0,r.jsxs)("ul",{className:"space-y-2",children:[r.jsx("li",{children:r.jsx(i(),{href:"/about",className:"text-gray-400 hover:text-white",children:"会社概要"})}),r.jsx("li",{children:r.jsx(i(),{href:"/contact",className:"text-gray-400 hover:text-white",children:"お問い合わせ"})}),r.jsx("li",{children:r.jsx(i(),{href:"/privacy",className:"text-gray-400 hover:text-white",children:"プライバシーポリシー"})})]})]}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-lg font-semibold mb-4",children:"お問い合わせ"}),(0,r.jsxs)("p",{className:"text-gray-400",children:["メール: info@aparelec.com",r.jsx("br",{}),"電話: 03-1234-5678"]})]})]}),r.jsx("div",{className:"mt-8 pt-8 border-t border-gray-700 text-center text-gray-400",children:r.jsx("p",{children:"\xa9 2024 AparelEC. All rights reserved."})})]})})]})}},5780:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>l});var r=t(997);t(6764);var a=t(968),i=t.n(a);let l=function({Component:e,pageProps:s}){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(i(),{children:[r.jsx("meta",{name:"viewport",content:"width=device-width, initial-scale=1"}),r.jsx("meta",{name:"description",content:"AparelEC - オンラインアパレルショップ"}),r.jsx("link",{rel:"icon",href:"/favicon.ico"})]}),r.jsx(e,{...s})]})}},8942:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>c});var r=t(997),a=t(6859),i=t.n(a);class l extends i(){render(){return(0,r.jsxs)(a.Html,{lang:"ja",children:[(0,r.jsxs)(a.Head,{children:[r.jsx("meta",{charSet:"utf-8"}),r.jsx("link",{rel:"preconnect",href:"https://fonts.googleapis.com"}),r.jsx("link",{rel:"preconnect",href:"https://fonts.gstatic.com",crossOrigin:"anonymous"}),r.jsx("link",{href:"https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap",rel:"stylesheet"})]}),(0,r.jsxs)("body",{children:[r.jsx(a.Main,{}),r.jsx(a.NextScript,{})]})]})}}let c=l},641:(e,s,t)=>{"use strict";t.d(s,{V:()=>r,n:()=>a});let r=e=>["タイムスタンプ,ステータス,場所",...e.map(e=>[e.timestamp,e.status,e.location]).map(e=>e.join(","))].join("\n"),a=(e,s)=>{let t=new Blob([e],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a"),a=URL.createObjectURL(t);r.setAttribute("href",a),r.setAttribute("download",s),r.style.visibility="hidden",document.body.appendChild(r),r.click(),document.body.removeChild(r)}},6764:()=>{},3524:e=>{"use strict";e.exports=require("@prisma/client")},1649:e=>{"use strict";e.exports=require("next-auth/react")},2785:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{"use strict";e.exports=require("next/head")},6689:e=>{"use strict";e.exports=require("react")},6405:e=>{"use strict";e.exports=require("react-dom")},997:e=>{"use strict";e.exports=require("react/jsx-runtime")},7147:e=>{"use strict";e.exports=require("fs")},1017:e=>{"use strict";e.exports=require("path")},2781:e=>{"use strict";e.exports=require("stream")},9796:e=>{"use strict";e.exports=require("zlib")}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[859,238,664,163],()=>t(5113));module.exports=r})();